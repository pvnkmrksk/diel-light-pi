<!DOCTYPE html>
<html>
<head>
    <title>Activity Monitoring Experiment</title>
</head>
<body>
    <h1>Activity Monitoring Experiment</h1>

    <label for="configFile">Config File:</label>
    <input type="file" id="configFile">

    <button onclick="openConfigFile()">Open Config File</button>
    <button onclick="saveConfigFile()">Save Config File</button>

    <h2>Experiment Settings</h2>

    <label for="experimenterName">Experimenter Name:</label>
    <input type="text" id="experimenterName">

    <label for="experimenterInitials">Experimenter Initials:</label>
    <input type="text" id="experimenterInitials">

    <label for="projectName">Project Name:</label>
    <input type="text" id="projectName">

    <label for="location">Location:</label>
    <input type="text" id="location">

    <label for="organism">Organism:</label>
    <input type="text" id="organism">

    <label for="outputPath">Output Path:</label>
    <input type="text" id="outputPath">

    <label for="interactiveMode">Interactive Mode:</label>
    <input type="checkbox" id="interactiveMode">

    <label for="autoStart">Auto Start:</label>
    <input type="checkbox" id="autoStart">

    <button onclick="generateCommand()">Generate Command</button>

    <textarea id="commandOutput" rows="10" cols="50" readonly></textarea>

    <p id="downloadPath"></p>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script>
        var originalConfig = {};  // To store the contents of the original config file
        var modifiedConfig = {};  // To store the modified config

        function openConfigFile() {
            var fileInput = document.getElementById("configFile");
            var file = fileInput.files[0];

            var reader = new FileReader();
            reader.onload = function(e) {
                var contents = e.target.result;
                originalConfig = jsyaml.load(contents);
                modifiedConfig = Object.assign({}, originalConfig);  // Copy the contents to modifiedConfig
                updateGuiElements();
            };
            reader.readAsText(file);
        }




        function saveConfigFile() {
            var fileInput = document.getElementById("configFile");
            var file = fileInput.files[0];
            var originalFilePath = fileInput.value;

            if (originalFilePath) {
                var directoryPath = originalFilePath.substring(0, originalFilePath.lastIndexOf("/") + 1);
                var configFilePath = directoryPath + "config.yaml";

                var experimenterName = document.getElementById("experimenterName").value;
                var experimenterInitials = document.getElementById("experimenterInitials").value;
                var projectName = document.getElementById("projectName").value;
                var location = document.getElementById("location").value;
                var organism = document.getElementById("organism").value;
                var outputPath = document.getElementById("outputPath").value;
                var interactiveMode = document.getElementById("interactiveMode").checked;
                var autoStart = document.getElementById("autoStart").checked;

                modifiedConfig.USER = experimenterName;
                modifiedConfig.INITIALS = experimenterInitials;
                modifiedConfig.PROJECT = projectName;
                modifiedConfig.LOCATION = location;
                modifiedConfig.ORGANISM = organism;
                modifiedConfig.OUTPATH = outputPath;
                modifiedConfig.INTERACTIVE = interactiveMode;
                modifiedConfig.AUTOSTART = autoStart;
                modifiedConfig.MOTIONPATH = "configs/motion_best.conf";
                modifiedConfig.TRIALNAME = "";
                modifiedConfig.TRIALNUM = 0;

                var fileContents = jsyaml.dump(modifiedConfig);

                var a = document.createElement("a");
                var file = new Blob([fileContents], {type: "text/yaml"});
                a.href = URL.createObjectURL(file);
                a.download = configFilePath;
                a.click();

                var downloadPath = "Download Path: " + configFilePath;
                document.getElementById("downloadPath").textContent = downloadPath;
            }
        }

        function generateCommand() {
            var experimenterName = document.getElementById("experimenterName").value;
            var experimenterInitials = document.getElementById("experimenterInitials").value;
            var projectName = document.getElementById("projectName").value;
            var location = document.getElementById("location").value;
            var organism = document.getElementById("organism").value;
            var outputPath = document.getElementById("outputPath").value;
            var interactiveMode = document.getElementById("interactiveMode").checked;
            var autoStart = document.getElementById("autoStart").checked;

            var command = `python3 run_diel-light.py --run --projectconf config.yaml`;

            document.getElementById("commandOutput").value = command;
        }

        function updateGuiElements() {
            document.getElementById("experimenterName").value = modifiedConfig.USER || "";
            document.getElementById("experimenterInitials").value = modifiedConfig.INITIALS || "";
            document.getElementById("projectName").value = modifiedConfig.PROJECT || "";
            document.getElementById("location").value = modifiedConfig.LOCATION || "";
            document.getElementById("organism").value = modifiedConfig.ORGANISM || "";
            document.getElementById("outputPath").value = modifiedConfig.OUTPATH || "";
            document.getElementById("interactiveMode").checked = modifiedConfig.INTERACTIVE || false;
            document.getElementById("autoStart").checked = modifiedConfig.AUTOSTART || false;
        }
    </script>
</body>
</html>
